<div class="card-box col-xs-10 col-xs-offset-1">
  <h1><%= @place.name %></h1>
  <i><%= @place.address %></i>
  <br/><br/>
  <p><%= @place.description %></p>

  <% if @place.latitude.present? && @place.longitude.present? %>
  <script src="https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=false"></script>
  <script>
    function initialize() {
      var myLatlng = new google.maps.LatLng(<%= @place.latitude %>,<%= @place.longitude %>);
      var mapOptions = {
        zoom: 12,
        center: myLatlng
      };
      var map = new google.maps.Map(document.getElementById('map-canvas'), mapOptions);

      var marker = new google.maps.Marker({
        position: myLatlng,
        map: map,
        title: 'Hello World!'
      });
    }

  google.maps.event.addDomListener(window, 'load', initialize);

  </script>

         <div id="map-canvas"></div>
<% end %>

<br />

  <div class="pull-right">
  	<% if current_user && (current_user == @place.user) %>
    <%= link_to 'Edit', edit_place_path(@place), :class => 'btn btn-primary' %>
    <%= link_to 'Destroy', place_path(@place), :method => :delete, :data => {:confirm => 'Are you sure you want to delete this?'},:class => 'btn btn-danger' %>
    <% end %>
  </div>
</div>

<div class="clear"></div>

<!-- Modal -->
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <h2 class="modal-title" id="myModalLabel">Add a Comment</h2>
      </div>
      <%= simple_form_for @comment, :url => place_comments_path(@place) do |f| %>
      <div class="modal-body">
        <%= f.input :message %>
        <%= f.input :rating, :as => :select, :collection => Comment::RATINGS %>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        <%= f.submit "Add a Comment", :class => 'btn btn-primary' %>
      </div>
      <% end %>
    </div>
  </div>
</div>

<div class="card-box col-xs-10 col-xs-offset-1">
<h1>Comments</h1>

<!-- Button trigger modal -->
<button class="btn btn-primary btn-lg pull-right" data-toggle="modal" data-target="#myModal">
  Add a comment
</button>
</div>

<div class="clear"></div>

<% @place.comments.each do |comment| %>
  <div class="col-xs-12 col-sm-6">
    <blockquote>
      <% if comment.humanized_rating.present? %>
        <b><%= comment.humanized_rating %></b> -
      <% end %>
      <%= comment.message %>
      <small><%= comment.user.email %></small>
    </blockquote>
  </div>
<% end %>

<div class="clear"></div>

<%= simple_form_for @photo, :url => '#' do |f| %>
  <%= f.input :caption %>
  <%= f.submit "Add a Photo", :class => 'btn btn-primary' %>
<% end %>

<script>
$(function(){
    //use mapselector="div" if you don't know the map id
    var mapSelector = "#map-canvas div";
    var attemptInterval = 2;
    var maxAttempts = 18;
    var mA = 0;
    var notYet = true;
    var titles = {"pan up":1,"pan down":1,"pan right":1,"pan left":1, "zoom in":1,"zoom out":1,"show street map":1,"show satellite imagery":1};
    
    function addKey(){
        mA++;
        if(mA > maxAttempts){return;}
        $(mapSelector).each(function(index){
        
            var title = this.getAttribute("title")
            if(title) title=title.toLowerCase().trim();
            if(title in titles){
                jqel = $(this);
                titles[title] = jqel;
                jqel.attr("tabindex","0");
                jqel.attr("role","button");
                jqel.keydown(function(ev){
                    if(ev.which==13) {
                        $(this).trigger("click")
                    }else if(ev.which==40) {
                        titles["pan down"].trigger("click");
                    }else if(ev.which==38) {
                        titles["pan up"].trigger("click");
                    }else if(ev.which==37) {
                        titles["pan left"].trigger("click");
                    }else if(ev.which==39) {
                        titles["pan right"].trigger("click");
                    }else if(ev.which==61 || ev.which == 187) {
                        titles["zoom in"].trigger("click");
                    }else if(ev.which==173 || ev.which == 189) {
                        titles["zoom out"].trigger("click");
                    }else{
                        return
                    }
                    ev.preventDefault();
                });
                
                (function(){
                    var mo = false;
                    var bo = jqel.css("border");
                    var ma = jqel.css("margin");
                    var bc = jqel.css("background-color");
                    var op = jqel.css("opacity");
                    
                    jqel.mouseover(function(){mo=true;});
                    jqel.mouseout(function(){mo=false;});
                    jqel.focus(function(){
                        if(mo)return;
                        $(this).css({"border":"2px solid blue","margin":"-2px","background-color":"transparent","opacity":"1"});
                    });
                    jqel.blur(function(){$(this).css({"border":bo,"margin":ma,"background-color":bc,"opacity":op});});
                    notYet = false;
                })();
            }
        });
        if(notYet){setTimeout(addKey,attemptInterval*1000);}
    }
    addKey();
});
</script>